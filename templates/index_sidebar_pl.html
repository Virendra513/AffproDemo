{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <!--
  <meta name="viewport" content="width=1200">
-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <link href="{% static 'img/favicon_qc.png' %}" rel="icon">
  <title>QClair-PLI</title>
  <link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>

  <link href="{% static 'css/style.css' %}" rel="stylesheet">

  <!-- 3D Mol -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/3Dmol/2.0.6/3Dmol-min.js"></script>
<script src="https://3Dmol.org/build/3Dmol-min.js"></script>      
<script src="https://3Dmol.org/build/3Dmol.ui-min.js"></script> 

<script src="https://cdn.jsdelivr.net/npm/ngl@latest/dist/ngl.js"></script>

<style>
  /* Ensure the container has explicit dimensions */
  #viewport {
    width: 800px;
    height: 600px;
    border: 1px solid black;
    position: absolute; /* This enables positioning using top/right */
    top: 250px;
    right: 15px;
    
  }


  .form_pl_1 {
    position: absolute;
    top: 16vh;
    left: 15vw;
    width: 25vw;
    padding: 5px;
    border: 1px solid black;
    border-radius: 8px;
    background-color: #f9f9f9;
    box-sizing: border-box;
  }

  .stack-container {
    display: flex;
    gap: 30px;
    justify-content: center;
    align-items: flex-start;
    flex-wrap: wrap;
  }
  
  /* Responsive stacking for tablet/mobile */
  @media (max-width: 1700px) {
    .stack-container {
      flex-direction: column;
      align-items: center;
      gap: 10px; /* vertical gap between stacked forms */
    }

    .predict-title
     {
      position: absolute !important;
      left: 25vw !important;
      top: auto;
      margin: 0 auto;
      font-size: 3.5vw !important;
      word-break: break-word !important;
    }

    
    .text-description
     {
      position: absolute !important;
      left: 25vw !important;
      top: auto;
      margin: 0 auto;
      font-size: 2.5vw !important;
      word-break: break-word !important;
    }




    .form_pl_1
     {
      position: absolute !important;
      width: 45vw;
      left: 25vw !important;
      top: 140px !important;
      margin: 0 auto;
      display: felx;
      z-index: 100;
    }

     
    .text_p  {
      position: absolute !important;
      left: 22.5vw !important;
      top: 910px !important;
      margin: 0 auto;
      font-size: 1.5vw !important;
      word-break: break-word !important;
    }

    .text_p span
    {
      font-size: 2.5vw !important;
    }
  
    .csv-form-container
    {
      position: absolute !important;
      width: 45vw !important;
      left: 25vw !important;
      top: 950px !important;
    }

    .csv-table-container
    {
      position: absolute! important;
      left: 25vw !important;
      
      top: 1125px !important;
      width: 45vw !important;
      margin: 0;
    }

    .copyright
    {
      text-align : left;
      font-size: 6px !important;
      word-break: break-word !important;
      bottom: 10px;

    }

    .Result_predict
    {
      font-size: 2vw!important;
    }

    .resultBox
    {
      width: 2vw !important;
      font-size: 1.65vw!important;
    }
    
    .home-button
    {
      left: 125px !important;
      
    }

    
    

    body .tooltip {
      all: unset; /* removes all inherited and default styles */
      display: grid !important;
      position: absolute !important;
      z-index: 99999 !important;
      background-color:  #007bff;
      padding: 0.5rem;
      color: #fff;
      border-radius: 5px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
      height: 65px;
      width: 125px;
      align-items: center;
    }

  

    


    nav {
      position: sticky;
      top: 0;
      left: 0;
      height: auto;
      background-color: #007bff;
      width: 16rem;
      padding: 1.8rem 0.85rem;
      color: #fff;
      display: flex;
      flex-direction: column;
      transition: width 0.5s ease-in-out;
    }
  

  }
  
</style>




<!--  PLI  -->
<style>

  .PLI_image {
    position: relative;
    width: 100%;
    max-width: 1200px;
    height: 90%;
    margin: 0 auto;
  
    background-image: url('{% static "img/DD_bg.jpeg" %}');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
  
    padding-top: 56.25%; /* 16:9 aspect ratio */
    box-sizing: border-box;
    overflow: hidden; /* Ensures children donâ€™t overflow the aspect box */
  }
  
  /* Text positioned over the image */
  .PLI_text {
    position: absolute !important; /* This is critical */
    top: 0;
    left: 0;
    z-index: 10;
  
    color: rgba(0, 0, 0, 0.7);
    font-size: clamp(14px, 2vw, 22px);
    font-weight: bold;
    padding: 2vw;
    text-shadow: 1px 1px 5px rgba(229, 241, 241, 0.7);
    max-width: 68vw;
    word-wrap: break-word;
    box-sizing: border-box;
    text-align: justify;
  }
  
</style>


<!--Protein Visualization  -->
<style>
/* Base styling for stack-container (horizontal layout by default) */
.stack-container-PV {
  display: flex;
  flex-direction: row;  /* Horizontal layout */
  align-items: flex-start;
  justify-content: flex-start;
  padding: 20px;
  gap: 20px; /* Horizontal gap between items */
}

#viewport {
  width: 775px;
  height: 600px;
  border: 1px solid black;
  position: absolute; /* This enables positioning using top/right */
  top: 265px;
  right: 15px;
  
}

.protein_structure_2 {
  display: flex;
  position: absolute !important;
  flex-direction: column;
  align-items: center;
  padding: 10px;
  border: 1px solid black;
  margin-bottom: 20px;
  width: 100%;
  max-width: 300px;
  top: 140px ;!important;
  right: 225px; !important;
  height:105px;

}







.protein_structure_2 h4 {
  
  padding: 5px;
  font-size: 14px;
  width: 300px;
  margin: 0 auto;
  text-align: center;
  
  
}

.protein_structure_2 input {
 
  padding: 5px;
  font-size: 14px;
  width: 250px;
  margin: 0 auto;
  
}

.protein_structure_2 button {
  
  padding: 5px;
  font-size: 14px;
  width: 250px;
  margin: 0 auto;
  
}



.protein_structure_1 {
  display: flex;
  justify-content: center;
  width: 100%;
  max-width: 800px;
}

/* Media query for smaller screen sizes */
@media (max-width: 1700px) {
  .stack-container-PV {
    flex-direction: column;  /* Stack the container items vertically */
    align-items: center;
    gap: 10px;  /* Vertical gap between stacked items */
  }

  .protein_structure_1 {
    position: absolute !important;
    width: 45vw;
    left: 25vw !important;
    top: 140px !important;
    margin: 0 auto;
    display: felx;
    z-index: 100;
  }

  .protein_structure_2 {
    display: flex;
    position: absolute !important;
    flex-direction: column;
    align-items: center;
    padding: 2px;
    border: 1px solid black;
    margin-bottom: 20px;
    width: 100%;
    max-width: 280px;
    top: 800px !important;
    left: 23vw  !important;
    height:105px;
  
  }


  #viewport {
    position: absolute! important;
    left: 23vw !important;
    top: 925px !important;
    width: 55vw !important;
    height: 500px;
    margin: 0;
  }


  .P_heading {
    font-size: 2vw;

  }

  


}

</style>

<style>
.faded-gif-3 {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  opacity: 0.5;        /* Controls how faded the gif is */
  z-index: -1;         /* Sends it behind all content in .services */
  pointer-events: none; /* Prevents gif from blocking interactions */
}


.faded-gif-2 {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  opacity: 0.05;        /* Controls how faded the gif is */
  z-index: -1;         /* Sends it behind all content in .services */
  pointer-events: none; /* Prevents gif from blocking interactions */
}

</style>

<style>
  .logout-btn {
    position: absolute;
    top: 30px;    /* Adjust top position */
    right: 50px;  /* Adjust right position */
    background-color:  #4aafee;
    color: white;
    padding: 10px 15px;
    border: none;
    cursor: pointer;
    border-radius: 5px;
    font-size: 18px;
    }
  .logout-btn:hover {
    background-color:rgb(196, 232, 233);
  }


  .navbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: #4aafee;
    padding: 15px;
    color: white;
}
</style>


<style>
  table {
      width: 100%;
      border-collapse: collapse;
  }
  table, th, td {
      border: 1px solid black;
  }
  th, td {
      padding: 8px;
      text-align: left;
  }
  th {
      background-color: #f2f2f2;
  }
</style>

<style>
.form-group {
  border: 1px solid #000;
  padding: 15px;
  border-radius: 8px;
  width: 100%;
  max-width: 400px;
  background-color: #f9f9f9;
  box-sizing: border-box;
  margin-bottom: 20px;
}

.form-group label {
  font-weight: bold;
  display: block;
  margin-bottom: 5px;
  font-size: 14px;
  color: #333;
}

.form-group input[type="text"] {
  width: 100%;
  padding: 8px 10px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 14px;
  box-sizing: border-box;
}


</style>


<style>
  .outer-container {
    border: 1px solid #000;
    padding: 15px;
    border-radius: 8px;
    width: 100%;
    max-width: 400px;
    background-color: #f9f9f9;
    box-sizing: border-box;
    margin: 20px auto;
  }
  
  .outer-container .form-group {
    border: 1px solid #ccc;
    padding: 10px;
    border-radius: 5px;
    background-color: #fff;
    margin-bottom: 10px;
  }
  
  .outer-container label {
    font-weight: bold;
    display: block;
    margin-bottom: 5px;
    font-size: 14px;
    color: #333;
  }
  
  .outer-container textarea,
  .outer-container input[type="file"] {
    width: 100%;
    padding: 8px 10px;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 14px;
    box-sizing: border-box;
    resize: vertical;
  }
  
  .outer-container h4 {
    text-align: center;
    margin: 10px 0;
    font-weight: bold;
    font-size: 16px;
  }
  
 
  </style>

  <style>
    #resultContainer {
      margin-top: 20px;
      padding: 15px;
      border: 2px solid black;
      border-radius: 5px;
      background-color: #f9f9f9;
      width: 100%;
      max-width: 400px;
      display: flex;
      align-items: center;
      gap: 10px;
      box-sizing: border-box;
    }
    
    #resultContainer h3 {
      margin: 0;
      white-space: nowrap;
      font-size: 16px;
    }
    
    #resultBox {
      flex-grow: 1;
      padding: 10px;
      border: 1px solid black;
      background-color: #fff;
      border-radius: 4px;
      font-weight: bold;
      text-align: center;
      font-size: 16px;
    }
    </style>
  
  <style> 

    .predict-title {
      position: absolute;
      top: 77.5px; /* same as padding-top in your inline style */
      left:285px;
      font-size: 24px;
      margin-bottom: 10px;
    }
    
    .text-description {
      position: absolute;
      top: 110px;
      font-size: 16px;
      left:285px;
      color: #444;
      margin-bottom: 20px;
    }
    
    .text_p {
      position: absolute;
      top: 130px;
      right: 200px;
      font-size: 8px;
      color: #333;
      
      white-space: nowrap;
      padding: 10px;
      border-radius: 5px;
      
      max-width: 80%;
    }
    
    .text_p span {
      font-size: 18px;
      font-weight: bold;
    }
    
    .text_p {
      font-size: 18px;
      color: #333;
    }
  </style>

  <style>
  /* Outer container for the CSV form */
  .csv-form-container {
    position: absolute;
    top: 170px;
    right: 300px;
    width: 500px;
    padding: 5px;
    border: 1px solid black;
    background-color: #f9f9f9;
    box-sizing: border-box;
    border-radius: 8px;
  }
  
  /* Form styling */
  .csv-form-container .csv-form {
    position: relative;
    width: 400px;
    height: 95px;
    border: 1px solid black;
    border-radius: 8px;
    padding: 20px;
    background-color: rgb(241, 238, 238);
  }
  
  /* File input styling */
  .csv-form-container .csv-form input[type="file"] {
    margin-bottom: 5px;
    width: 100%;
    padding: 8px;
    font-size: 14px;
    border: 1px solid #ccc;
    border-radius: 4px;
  }
  
  /* Submit button styling */
  .csv-form-container .csv-form button {
    padding: 5px 5px;
    font-size: 14px;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  }
  
  .csv-form-container .csv-form button:hover {
    background-color: #45a049;
  }
  
  /* Hidden input for form type */
  .csv-form-container .csv-form input[type="hidden"] {
    display: none;
  }
</style> 


<style>
  .csv-table-container {
    position: absolute;
    top: 325px;
    right: 50px;
    width: 100%;
    max-width: 1000px;
    height: 500px;
    padding: 5px;
    box-sizing: border-box;
    overflow-x: auto;
    border: 1px solid black;
    border-radius: 8px;
  }

  .csv-table {
    position: relative;
    width: 100%;
    height: 100%;
    overflow-y: auto;
    background-color: #f8f8f8;
    border: 1px solid black;
    border-radius: 8px;
    box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
  }

  .csv-table table {
    width: 100%;
    min-width: 960px;
    border-collapse: collapse;
    table-layout: fixed;
  }

  .csv-table thead th {
    position: sticky;
    top: 0;
    background-color: #e0e0e0;
    z-index: 2;
    border-bottom: 1px solid #ccc;
    padding: 8px;
  }

  .csv-table th,
  .csv-table td {
    text-align: left;
    padding: 8px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    border-right: 1px solid #ddd;
  }

  /* Fixed width per column by assigning specific classes */
  .col-smiles,
  .col-protein,
  .col-prediction {
    width: 320px;
  }

  .csv-table td:last-child,
  .csv-table th:last-child {
    border-right: none;
  }

  .csv-table .empty-row td {
    text-align: center;
    padding: 10px;
  }
</style>

  
<style> 
.csv-download-button {
  position: absolute;
  top: 400px;
  right: 450px;
}

.csv-download-button button {
  padding: 8px 16px;
  font-size: 14px;
  color: black;
  border: 1px solid #333;
  background-color:  #4aafee;
  border-radius: 4px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.csv-download-button button:hover {
  background-color:rgb(3, 43, 88);
}
</style> 

<style>
.csv-upload-message {
  position: absolute;
  top: 25px;
  right: 170px;
  width: 400px;
  padding: 15px;
  
  font-size: 14px;
  color: #333;
}

.faded-gif-4 {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  opacity: 0.1;        /* Controls how faded the gif is */
  z-index: -1;         /* Sends it behind all content in .services */
  pointer-events: none; /* Prevents gif from blocking interactions */
}
</style>

<!-- Ligand Visualization CSS-->

<style>
.L_visualization-container {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 5px;
}

.L_visualization-box {
  flex: 2.5;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  text-align: center;
  width: 400px;
  height: 600px;
  border: 1px solid black;
  padding: 10px;
  border-radius: 5px;
}


.L_visualization-header {
  text-align: left;
  margin-bottom: 20px;
}

.L_visualization-header h1 {
  font-size: 2em;
  margin: 0;
}

.L_visualization-header p {
  font-size: 1.1em;
  color: #555;
  margin-top: 5px;
}


@media (max-width: 1700px) {
  .L_visualization-container {
      flex-direction: column;
      align-items: flex-start !important;
  
  }

  .L_visualization-box {
    width: 68vw;
    height: 1800px !important;

  }

  .L_visualization-header h1 {
    font-size: 6vw;
    margin: 0;
  }
  
  .L_visualization-header p {
    font-size: 3vw;
    color: #555;
    margin-top: 5px;
  }
  
}
</style>

<!-- Molecular Proerties-->
<style>
  .descriptor-container {
    display: flex;
    justify-content: space-between;
    gap: 20px;
    flex-wrap: wrap;
    margin-bottom: 40px;
}

.descriptor-box {
    flex: 1;
    min-width: 300px;
}

.descriptor-heading {
    text-align: center;
    max-width: 500px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    margin: 0 auto 15px;
    font-size: 1.5em;
}

.descriptor-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 1em;
}

.descriptor-table th,
.descriptor-table td {
    border: 1px solid black;
    text-align: center;
    padding: 8px;
}

.Mol_P {
  text-align: left;
  padding: 10px;
}

.Mol_P h1 {
  font-size: 2.5em;
  margin-bottom: 10px;
}

.Mol_P .text {
  font-size: 1.2em;
  color: #444;
  max-width: 800px;
  text-align: left;
}

/* Responsive for screens below 900px */
@media (max-width: 1700px) {
  .descriptor-container {
      flex-direction: column;
      align-items: flex-start; /* center them horizontally */
      width: 10vw;
  }

  .descriptor-box {
      width: 10vw; /* optional: limits box width on large screens */
      align-items: flex-start !important;
  }

  .descriptor-table {
    width: 5vw;
    border-collapse: collapse;
    font-size: 3vw;
    overflow: hidden;
}
.descriptor-table th,
.descriptor-table td {
    border: 1px solid black;
    text-align: left;
    width: 5vw;
}

.descriptor-heading {
  text-align: center;
  max-width: 200px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  margin: 0 auto 15px;
  font-size: 1em;
}

.Mol_P {
  text-align: left;
  padding: 10px;
}

.Mol_P h1 {
  font-size: 4vw;
  text-align: left;
}

.Mol_P .text {
  font-size: 1.45vw;
  text-align: left;
}

}


</style>  

<!-- Pdb Table Container Results -->
<style>

  h1.content_pdb {
    font-size: 2.5em;
    margin-bottom: 10px;
  }

  #pdb_table_container {
    max-width: 70vw;
    max-height: 600px;
    overflow: auto;
    margin: 20px; /* Removed 'auto' to align left */
    border: 1px solid #ccc;
    padding: 15px;
    background-color: #f9f9f9;
    border-radius: 8px;
    text-align: left; /* Ensures text/content aligns left */
  }
  
  #pdb_table_container table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.9em;
    text-align: left; /* Table text aligns left */
  }
  
  #pdb_table_container th,
  #pdb_table_container td {
    border: 1px solid #999;
    padding: 8px;
    text-align: left; /* Ensure cell content is left-aligned */
  }
  
  #pdb_table_container th {
    background-color: #e0e0e0;
    position: sticky;
    top: 0;
    z-index: 1;
  }
  

  @media (max-width: 1700px) {
    #pdb_table_container {
      max-width: 60vw;
      max-height: 550px;
    }

    h1.content_pdb {
      font-size: 4vw;
      margin-bottom: 10px;
    }



  }
  
</style>



<!--batch results -->
<style>

  /* Main container for batch results */
.batch-container {
    position: relative; /* or use static if you don't need absolute */
    top: 25px;
    width: 100%;
    max-width: 1500px; /* optional: limits expansion on larger screens */
    height: auto;
    padding: 5px;
    margin-left: 0;
}

/* Styling for the scrollable table container */
#csv_table {
    position: relative;
    width: 1500px;
    height: 700px;
    overflow-y: auto;
    padding: 10px;
    background-color: #f8f8f8;
    border: 1px solid black;
    border-radius: 8px;
    box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
}

/* Table styling */
#csv_table table {
    width: 960px;
    border-collapse: collapse;
    table-layout: fixed;
}

#csv_table th,
#csv_table td {
    width: 490px;
    text-align: left;
    padding: 5px;
    word-break: break-word;
    white-space: normal;
}

/* Header background color */
#csv_table thead tr {
    background-color: #e0e0e0;
}

/* Download button positioning and style */
.download-btn-container {
    position: absolute;
    top: 725px;
    left: 15px;
}

.download-btn-container button {
    padding: 8px 16px;
    font-size: 14px;
}

/* Message when no CSV is found */
.no-results-message {
    position: absolute;
    
    
    width: 400px;
    padding: 15px;
}


@media (max-width: 1700px) {
  #csv_table {
      width: 65vw; /* 90% of viewport width */
      margin-left: 0 !important;
      margin-right: auto;
  }

  #csv_table table {
      width: 100%; /* Make table take full width of its container */
  }

  #csv_table th,
  #csv_table td {
      width: auto; /* Allow automatic width distribution */
      word-break: break-word;
      white-space: normal;
      text-align: left;
      padding: 5px;
  }
}



</style>



<!-- Analysis -->
<style>
/* Container for the analysis section */
#Analysis {
    display: none;
    padding: 20px;
    box-sizing: border-box;
}

/* Home button styling */
.home-button {
    padding: 8px 16px;
    font-size: 14px;
    cursor: pointer;
    margin-bottom: 20px;
}

/* Container for the top N table */
#n_top_table {
    margin-top: 25px;
    margin-left: 0;
    margin-right: auto; /* Align to the right */
    max-width: 1600px;
    max-height: 500px;
    overflow: auto;
    border: 2px solid black;
    padding: 0;
    box-sizing: border-box;
    background-color: #f9f9f9;
    border-radius: 8px;
    box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.1);
}

/* Sticky header title */
#n_top_table h2 {
    position: sticky;
    top: 0;
    background: #ffffff;
    z-index: 3;
    margin: 0;
    padding: 10px;
    border-bottom: 2px solid black;
    box-sizing: border-box;
    font-size: 18px;
}

/* Table base styling */
#n_top_table table {
    width: 100%;
    border-collapse: collapse;
    border: 2px solid black;
    box-sizing: border-box;
    background-color: #fff;
}

/* Table headers and cells */
#n_top_table th,
#n_top_table td {
    max-width: 300px;
    word-wrap: break-word;
    border: 1px solid black;
    box-sizing: border-box;
    padding: 8px;
    text-align: left;
    background-color: #fff;
}

/* Sticky header cells */
#n_top_table th {
    position: sticky;
    top: 50px;
    background: #fff;
    z-index: 2;
}

/* Download button below table */
#n_top_table + div {
    margin-top: 15px;
}

#n_top_table + div button {
    padding: 8px 16px;
    font-size: 14px;
    cursor: pointer;
}

@media (max-width: 1700px) {
  /* Main table container styling */
  #n_top_table {
      width: 62.5vw; /* 62.5% of the viewport width */
      margin-left: 0;
      margin-right: auto; /* Align to the right */
  }

  /* Table styling */
  #n_top_table table {
      width: 100%; /* Make table take full width of its container */
      table-layout: fixed; /* Ensures fixed column widths */
  }

  #n_top_table th,
  #n_top_table td {
      width: auto; /* Allow automatic width distribution */
      word-break: break-word;
      white-space: normal;
      text-align: left;
      padding: 8px;
  }
}

</style>

<!-- User Data -->

<style>
  /* User Data Section Styling */
  #User\ Data {
      display: none;
      padding: 10px;
      box-sizing: border-box;
  }
  
  /* Home button inside User Data */
  #User\ Data .home-button {
      padding: 8px 16px;
      font-size: 14px;
      cursor: pointer;
      margin-bottom: 20px;
  }
  
  /* Header Styling */
  #User\ Data h1 {
      font-size: 24px;
      margin-top: 10px;
  }
  
  /* Table container */
  #User\ Data .user-table-container {
    position: relative;
    margin-top: 20px;
    margin-left: 0;       /* Align to the left */
    margin-right: auto;   /* Pushes it away from the right */
    width: 1000px;
    max-height: 650px;
    overflow-y: auto;
    border: 1px solid black;
    border-radius: 8px;
    box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.1);
    background-color: #fff;
  }
  
  /* Table styling */
  #User\ Data table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
  }
  
  /* Table header styling */
  #User\ Data th {
      padding: 8px 12px;
      border: 1px solid black;
      text-align: center;
      background-color: #f4f4f4;
      font-weight: bold;
  }
  
  /* Table cell styling */
  #User\ Data td {
      padding: 8px 12px;
      border: 1px solid black;
      text-align: center;
      vertical-align: top;
      word-wrap: break-word;
      white-space: normal;
  }
  
  /* No data message */
  #User\ Data p {
      text-align: center;
      font-size: 1.2em;
      color: #888;
      margin-top: 20px;
  }
  
  /* Responsive for large screens */
  @media (max-width: 1700px) {
      #User\ Data .user-table-container {
          width: 65vw;
          margin-left: 0;
          margin-right: auto;
      }

      #User\ Data h1 {
        font-size: 4vw;
        margin-top: 10px;
        text-align: left;  /* Align heading to the left */
    }
  }
  

</style> 

<style>
  .video-wrapper {
    position: absolute;
    top: 175px;
    width: 70vw;            /* full width of container or screen */
    max-width: 900px;       /* don't exceed this width */      
    padding: 0;
    
    
    margin-left: 150px;
    margin-right: auto;
    margin-top: 50px;
    
    
  }

  .video-wrapper video {
    width: 100%;            /* scales with wrapper */
    height: 100%;           /* maintain aspect ratio */
    display: block;
    margin-top: 0;
    border: 2px solid black;
    border-radius: 10px;
    
  }


  @media (max-width: 1700px) {
    .video-wrapper {
        width: 65vw;
        margin-left: 0;
        margin-right: auto;
    }
}
</style>



</head>

<body>
  <nav>
    <div class="sidebar-top">
      <span class="shrink-btn">
        <i class='bx bx-chevron-left'></i>
      </span>
      
      <a href="{% url 'home' %}">
        <img src="{% static 'img/favicon_qc.png' %}" class="logo" alt="Home">
      </a>
      <h3 class="hide">QClair-PLI</h3>
    </div>

    <div class="search">
      <i class='bx bx-search'></i>
      <input type="text" class="hide" placeholder="Quick Search ...">
    </div>

    <div class="sidebar-links">
      <ul>
        <div class="active-tab"></div>
        <li class="tooltip-element" data-tooltip="0">
          <a href="#" class="active" data-active="0" onclick="showContent('Predict')">
            <div class="icon">
              <i class='bx bxs-brain' ></i>
              <i class='bx bxs-brain'></i>
            </div>
            <span class="link hide">Predict</span>
          </a>
        </li>
        <li class="tooltip-element" data-tooltip="1">
          <a href="#"  data-active="1" onclick="showContent('QClair-PLI')">
            <div class="icon">
              <i class='bx bxs-info-circle'></i>
              <i class='bx bxs-info-circle'></i>
            </div>
            <span class="link hide">QClair-PLI</span>
          </a>
        </li>
        <li class="tooltip-element" data-tooltip="2">
          <a href="#" data-active="2" onclick="showContent('Protein Structure Visualization')">
            <div class="icon">
              <i class='bx bx-dna'></i>
              <i class='bx bx-dna'></i>
            </div>
            <span class="link hide">Protein Structure Visualization</span>
          </a>
        </li>
        <li class="tooltip-element" data-tooltip="3">
          <a href="#" data-active="3" onclick="showContent('Ligand Struture Visualization')">
            <div class="icon">
              <i class='bx bx-atom'></i>
              <i class='bx bx-atom'></i>
            </div>
            <span class="link hide">Ligand Struture Visualization</span>
          </a>
        </li>
        <li class="tooltip-element" data-tooltip="4">
          <a href="#" data-active="4" onclick="showContent('Molecular Properties')">
            <div class="icon">
              <i class='bx bxs-bar-chart-alt-2'></i>
              <i class='bx bxs-bar-chart-alt-2'></i>
            </div>
            <span class="link hide">Molecular Properties</span>
          </a>
        </li>

        <li class="tooltip-element" data-tooltip="5">
          <a href="#" data-active="5" onclick="showContent('PDB File Content')">
            <div class="icon">
              <i class='bx bxs-file'></i>
              <i class='bx bxs-file'></i>
            </div>
            <span class="link hide">PDB File Content</span>
          </a>
        </li>

        <li class="tooltip-element" data-tooltip="6">
          <a href="#" data-active="6" onclick="showContent('Batch Results')">
            <div class="icon">
              <i class='bx bxs-download'></i>
              <i class='bx bxs-download'></i>
            </div>
            <span class="link hide">Batch Results</span>
          </a>
        </li>


        <li class="tooltip-element" data-tooltip="7">
          <a href="#" data-active="7" onclick="showContent('Analysis')">
            <div class="icon">
              <i class='bx bxs-analyse'></i>
              <i class='bx bxs-analyse'></i>
            </div>
            <span class="link hide">Analysis</span>
          </a>
        </li>

        <li class="tooltip-element" data-tooltip="8">
          <a href="#" data-active="8" onclick="showContent('User Data')">
            <div class="icon">
              <i class='bx bxs-user-circle'></i>
              <i class='bx bxs-user-circle'></i>
            </div>
            <span class="link hide">{{username}}'s PLI</span>
          </a>
        </li>

        
        <div class="tooltip">
          <span class="show">Predict</span>
          <span>QClair-PLI</span>
          <span>Protein Structure Visualization</span>
          <span>Ligand Struture Visualization</span>
          <span>Molecular Properties</span>
          <span>PDB File Content</span>
          <span>Batch Results</span>
          <span>Analysis</span>
          <span>User Data</span>
        </div>
      </ul>
      
    </div>

    <div class="sidebar-footer">
      <a href="#" class="account tooltip-element" data-tooltip="10">
        <i class='bx bx-user'></i>
      </a>
      <div class="admin-user tooltip-element" data-tooltip="11">
        <div class="admin-profile hide">
          <a>
            <img src="{% static 'img/user.png' %}" class="logo" alt="Home">
          </a>
          <div class="admin-info">
            <h4>{{username}}</h4>
          </div>
        </div>
        
        <a href='{% url 'logout' %}' class="log-out">
          <i class='bx bx-log-out'></i>
        </a>
        
      </div>
      
    </div>
  </nav>

  <main>
    
    <div id="Predict" class="content" style="display:block;">
      <img src="{% static 'video/gif_mol_2.gif' %}"   class="faded-gif-3">
      <div class="stack-container">
      <button class="home-button" onclick="location.href='{% url 'home' %}'">Home</button>
      <br>
      <h1 class="predict-title">Predict Ki (Inhibition Constant)</h1>
      <p class="text-description">Give input as Ligand SMILES and PDB File/Protein Sequence.</p>

      <div class="form_pl_1" >
      <!-- Form inside Projects Section -->
      <form id="projectForm" action="{% url 'process_form_pl' %}" method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <input type="hidden" name="form_type" value="project">
        <!-- Rest of the form fields -->

        <div class="form-group">
          <label for="input1_pl" >Ligand SMILES*</label>
          <input type="text" id="input1_pl" name="input1_pl" value="{{ input1 }}" placeholder="Enter SMILES e.g: CCC"  required >
        </div>
        

      



        <div class="outer-container">

          <!-- Protein Sequence Input -->
          <div class="form-group" >
              <label for="input2_pl" style="font-weight: bold;">Protein Sequence</label>
              <textarea id="input2_pl" name="input2_pl" placeholder="Enter Protein Sequence e.g: AAAAA"  > {{ input2 }} </textarea>
          </div>

    




          <!-- OR Section -->
          <h4 >OR</h4>
      
          <!-- Upload PDB File -->
           
          <div class="form-group">
              <label for="input3_pl">Upload PDB File</label>
              <input type="file" id="input3_pl" name="input3_pl" accept=".pdb">

          </div>
    
        </div>

      
        
        <button type="button" onclick="validateAndSubmit()">Submit</button>

        

        <script>
          // Restore values from localStorage on page load
          window.onload = function() {
              const savedInput1 = localStorage.getItem('input1_pl');
              const savedInput2 = localStorage.getItem('input2_pl');
      
              if (savedInput1) document.getElementById('input1_pl').value = savedInput1;
              if (savedInput2) document.getElementById('input2_pl').value = savedInput2;
          };
      
          // Validate SMILES and Protein, then handle submission
          async function validateAndSubmit() {
              const input1 = document.getElementById("input1_pl").value.trim(); // SMILES
              const input2 = document.getElementById("input2_pl").value.trim(); // Protein Sequence
              const fileInput = document.getElementById("input3_pl");           // File Input
              const hasFile = fileInput.files.length > 0;
      
              if (!input1) {
                  alert("Please enter a SMILES string.");
                  return;
              }
      
              // Save values locally for future use
              localStorage.setItem('input1_pl', input1);
              localStorage.setItem('input2_pl', input2);
      
              try {
                  // Validate SMILES string via backend
                  const response = await fetch("{% url 'validate_smiles' %}", {
                      method: 'POST',
                      headers: {
                          'Content-Type': 'application/json',
                          'X-CSRFToken': '{{ csrf_token }}'
                      },
                      body: JSON.stringify({ smiles: input1 })
                  });
      
                  const result = await response.json();
      
                  if (!result.valid) {
                      alert("Invalid SMILES string! Please check your input.");
                      return;
                  }
      
                  // If Protein Sequence is provided â€” validate it too
                  if (input2 !== "") {
                      const proteinResponse = await fetch("{% url 'validate_protein' %}", {
                          method: 'POST',
                          headers: {
                              'Content-Type': 'application/json',
                              'X-CSRFToken': '{{ csrf_token }}'
                          },
                          body: JSON.stringify({ protein: input2 })
                      });
      
                      const proteinResult = await proteinResponse.json();
      
                      if (!proteinResult.valid) {
                          alert("Invalid Protein Sequence! Please ensure only valid amino acid letters are used (A, C, D, E, F, G, H, I, K, L, M, N, P, Q, R, S, T, V, W, Y).");
                          return;
                      }
                  }
      
                  // Final check: at least Protein or File must be provided
                  if (input2 !== "" || hasFile) {
                      document.getElementById("loadingSpinner_2").style.display = "block";
                      document.getElementById("projectForm").submit();  // Submit the form
                  } else {
                      alert("Please fill in at least one of Protein Sequence or upload a PDB File.");
                  }
      
              } catch (error) {
                  console.error("Validation error:", error);
                  alert("Could not validate SMILES or Protein. Please try again.");
              }
          }
        </script>
      
    
  
        <div id="resultContainer">
          <h3 class="Result_predict" >Result: Ki(nM)</h3>
          <div class="resultBox" id="resultBox">
              {{ result }}
          </div>
        </div>
      
        <button type="button" id="clearBtn">Clear</button>
      
      </form>
      
      </div>


      

      <p class="text_p" >
        <span >Batch Processing:</span> 
        Give input as a CSV file which contains Ligand SMILES and Protein Sequence.</p>
    

      <div class="csv-form-container">
      
        <form id="csv_form" action="{% url 'process_form_pl' %}" method="POST" enctype="multipart/form-data">
          {% csrf_token %}
          <input type="file" id="csvfile" name="csv_file" accept=".csv">
          <button type="submit" onclick="showLoading()" >Process CSV</button>
          <!-- Hidden field to distinguish the CSV form -->
          <input type="hidden" name="form_type" value="csv_form">
        </form>

      </div>  
      
      <div class="csv-table-container">
        
        {% if csv_data %}
          <div id="csv_table">
            <table border="1">
                <thead>
                    <tr style="background-color: #e0e0e0;">
                        <th >Ligand (SMILES)</th>
                        <th >Protein Sequence</th>
                        <th >Predicted_Ki(nM)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in result_2 %}
                    <tr>
                        <td >{{ row.ligand }}</td>
                        <td >{{ row.protein }}</td>
                        <td >{{ row.prediction }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="3">No results found.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
          </div>

          <!-- Download CSV Button -->
          <div class="csv-download-button">
            <button type="button" onclick="downloadCSV_2()">Download CSV</button>
          </div>

        

        

        
        <script>
          // On page load, check if there's a saved value for both SMILES and Protein Sequence
          window.onload = function() {
              // Retrieve saved values from localStorage
              const savedInput1 = localStorage.getItem('input1_pl');
              const savedInput2 = localStorage.getItem('input2_pl');
              
              // Set the saved values to the input and textarea fields if available
              if (savedInput1) {
                  document.getElementById('input1_pl').value = savedInput1;
              }
      
              if (savedInput2) {
                  document.getElementById('input2_pl').value = savedInput2;
              }
          }
      
          // Save the values of SMILES and Protein Sequence to localStorage when the form is submitted
          document.getElementById('projectForm').addEventListener('submit', function() {
              const input1Value = document.getElementById('input1_pl').value.trim();
              const input2Value = document.getElementById('input2_pl').value.trim();
      
              // Save the values to localStorage if they are not empty
              if (input1Value) {
                  localStorage.setItem('input1_pl', input1Value);
              }
      
              if (input2Value) {
                  localStorage.setItem('input2_pl', input2Value);
              }
          });
      </script>
      
        

        <script>
          function downloadCSV_2() {
              var csv = [];
              var table = document.querySelector("#csv_table table");
      
              if (!table) {
                  alert("No table found to download.");
                  return;
              }
      
              var rows = table.querySelectorAll("tr");
      
              for (var i = 0; i < rows.length; i++) {
                  var row = [];
                  var cols = rows[i].querySelectorAll("th, td");
      
                  for (var j = 0; j < cols.length; j++) {
                      var data = cols[j].innerText.trim().replace(/"/g, '""'); // Trim spaces & escape quotes
                      row.push('"' + data + '"');
                  }
      
                  if (row.length > 0) {
                      csv.push(row.join(","));
                  }
              }
      
              if (csv.length === 0) {
                  alert("No data found in the table.");
                  return;
              }
      
              var csv_string = csv.join("\n");
              var filename = "downloaded_prediction.csv";
              var blob = new Blob([csv_string], { type: "text/csv;charset=utf-8;" });
      
              if (navigator.msSaveBlob) {
                  navigator.msSaveBlob(blob, filename);
              } else {
                  var link = document.createElement("a");
                  var url = URL.createObjectURL(blob);
                  link.href = url;
                  link.download = filename;
                  document.body.appendChild(link);
                  link.click();
                  document.body.removeChild(link);
              }
          }
        </script>
      
          

        {% else %}
        <div class="csv-upload-message">
          <p>Upload the CSV..</p>
        </div>
        {% endif %}
      </div>
      </div>




          <!-- Loading Spinner -->
    <div id="loadingSpinner" style="
    display: none; /* Initially hidden */
    position: absolute;
    top: 500px;
    left: 1350px;
    transform: translate(-50%, -50%);
    font-size: 24px;
    color: #333;
    text-align: center;">
    <div class="spinner"></div>
    <p>Processing CSV data...</p>
    </div>


    <div id="loadingSpinner_2" style="
    display: none; /* Initially hidden */
    position: absolute;
    top: 450px;
    left: 950px;
    transform: translate(-50%, -50%);
    font-size: 24px;
    color: #333;
    text-align: center;">
    <div class="spinner"></div>
    <p>Processing User Input...</p>
    </div>









    <!-- Style for Spinner -->
    <style>
    .spinner {
        border: 4px solid rgba(0, 0, 0, 0.1);
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border-left-color: #09f;
        animation: spin 1s linear infinite;
        margin: auto;
    }

    @keyframes spin {
        from {
            transform: rotate(0deg);
        }
        to {
            transform: rotate(360deg);
        }
    }
    </style>


    <!-- Show Spinner on Upload -->
    <script>
    function showLoading() {
        // Hide CSV Table (Reset Data)
        document.getElementById("csv_table").innerHTML = "<p>Loading...</p>";

        document.getElementById("loadingSpinner").style.display = "block";
    }
    </script>

    <script>
      function showLoading_2() {
        var input1 = document.getElementById("input1_pl").value.trim();
        var input2 = document.getElementById("input2_pl").value.trim();
        var input3 = document.getElementById("input3_pl").value.trim();



    
        if ((input1 !== "" && input2 !== "") || (input1 !== "" && input3 !== ""))  {
            document.getElementById("loadingSpinner_2").style.display = "block";
        } else {
            alert("Please fill in both inputs before proceeding.");
        }
      }
    </script>


    
  

    
    





      <script>
          document.addEventListener("DOMContentLoaded", function () {
              const form = document.querySelector("#projectForm");
              const inputLigand = document.querySelector("#input1_pl");
              const inputProtein = document.querySelector("#input2_pl");
              const resultText = document.querySelector("#resultBox"); // Select the result text element
              const clearBtn = document.querySelector("#clearBtn");
              

              // Restore saved values from localStorage if available
              inputLigand.value = localStorage.getItem("input1_pl") || "";
              inputProtein.value = localStorage.getItem("input2_pl") || "";
            

              form.addEventListener("submit", function () {
                  // Save inputs to localStorage before submission
                  localStorage.setItem("input1_pl", inputLigand.value);
                  localStorage.setItem("input2_pl", inputProtein.value);
              });

              // Clear stored values when clicking "Clear" button
              clearBtn.addEventListener("click", function () {
                  localStorage.removeItem("input1_pl");
                  localStorage.removeItem("input2_pl");
                  inputLigand.value = "";
                  inputProtein.value = "";
                  resultText.textContent = ""; // Clear the result text
              });
          });
      </script>

      <script>
        document.getElementById("projectForm").addEventListener("submit", function(event) {
            let smiles = document.getElementById("input1_pl").value.trim();
            let protein = document.getElementById("input2_pl").value.trim();
            let pdbFile = document.getElementById("input3_pl").files.length;
    
            // SMILES is always required
            if (!smiles) {
                event.preventDefault();
                alert("Ligand SMILES is required.");
                return;
            }
    
            // Either Protein Sequence or PDB file is required
            if (!protein && !pdbFile) {
                event.preventDefault();
                alert("Please provide either a Protein Sequence or upload a PDB file.");
                return;
            }
        });
      </script>
      

    </div>
  

    <div id="QClair-PLI" class="content" style="display:none;">
      <button class="home-button" onclick="location.href='{% url 'home' %}'">Home</button>
      </br>
      </br>

      <div class="PLI_image" >

        <p class="PLI_text" >
      
            QClair-AffPro Affinity Predictor is an advanced computational model designed to evaluate the interaction strength between a protein and a ligand,
            expressed as binding affinity, often quantified by inhibitory constants (Ki). Accurate prediction of binding affinity is a critical component in drug discovery.
        </p>

        <div class="video-wrapper">
          <video controls>
            <source src="{% static 'video/DTI.mp4' %}" type="video/mp4">
            Your browser does not support the video tag.
          </video>
        </div>
      </div>
    </div>

   


    <div id="Protein Structure Visualization" class="content" style="display:none;">
      <img src="{% static 'video/gif_p_4.gif' %}"   class="faded-gif-2">
      
      <button class="home-button" onclick="location.href='{% url 'home' %}'">Home</button>
      </br>
      </br>
      <h1 class="P_heading">Visualize Protein from Inputted PDB File </h1>
      <div style=" text-align: center;">
        </br>
        <!-- <h2>Protein Structure Visualization</h2> -->
        </br>
        </br>
        </br>
        

        <script>
          document.getElementById("loadBtn").addEventListener("submit", function() {
            var fileInput = document.getElementById("input4_pl");
            if (fileInput.files.length === 0) {
              alert("Please select a file to upload.");
              return;
            }
            
            var form = document.getElementById("pbdform");
            var formData = new FormData(form);
            
            // Log the file to ensure it's attached
            console.log("Selected file:", fileInput.files[0]);
            
            fetch(form.action, {
              method: 'POST',
              body: formData,
              credentials: 'same-origin'
            })
            .then(response => {
              const contentType = response.headers.get('content-type');
              if (contentType && contentType.includes('application/json')) {
                return response.json();
              } else {
                return response.text();
              }
            })
            .then(data => {
              console.log('Success:', data);
              // Update your UI accordingly here.
            })
            .catch(error => {
              console.error('Error:', error);
            });
          });
        </script>



      <div class="stack-container-PV">
        
    
        <div class="protein_structure_1" id="viewer-container">
          {{ pdb_visual|safe }}
        </div>
        <!--- 

        <div style="height:600px; width:700px; position:absolute; top:225px; left:1150px;"
            class="viewer_3Dmoljs" 
            data-pdb="2AZW" 
            data-backgroundcolor="0xffffff" 
            data-style="ballstick"
            data-ui="true">
        </div>
        -->
        <div class="protein_structure_2">
          <h4 >Load a Protein Structure by PDB ID</h4>
          <input type="text" id="pdbId" placeholder="Enter PDB ID (e.g., 1crn)">
          <button onclick="loadStructure()">Load Structure</button>
        </div>
        <div id="viewport"></div>
        
        <script>
          var stage;
      
          // Initialize stage after window load to ensure container is ready
          window.onload = function() {
            stage = new NGL.Stage("viewport");
          };
      
          // Function to load the structure using the PDB ID entered by the user
          function loadStructure() {
            var pdb = document.getElementById('pdbId').value.trim();
            if (!pdb) {
              alert("Please enter a valid PDB ID.");
              return;
            }
            
            // Clear previous components
            stage.removeAllComponents();
            
            // Load the structure from RCSB using the provided PDB ID
            stage.loadFile("rcsb://" + pdb, { defaultRepresentation: true })
              .then(function(component) {
                stage.autoView();
                stage.handleResize();
              })
              .catch(function(error) {
                alert("Error loading structure: " + error);
              });
          }
        </script>
      </div>
      </div> 
      
    </div> 

    

    

    









    <div id="Ligand Struture Visualization" class="content" style="display:none;">
      <img src="{% static 'video/gif_mol_1.gif' %}"   class="faded-gif-4">
      
      <button class="home-button" onclick="location.href='{% url 'home' %}'">Home</button>
      </br>
      </br>
      <div class="L_visualization-header">
        <h1>Visualize Ligand</h1>
        <p>Visualization of Ligand 2D and 3D structure.</p>
      </div>
          <br>
          
          <!-- Third Div: Protein Sequence Visualization -->
          <div class="L_visualization-container">
            <!-- First Div: SMILES 2D Visualization -->
            <div class="L_visualization-box">
                <h2 style="margin: 0;">SMILES 2D Visualization:</h2>
                <br>
                {{ smiles_visualization|safe }}
            </div>
            <!-- Second Div: SMILES 3D Visualization -->
            <div class="L_visualization-box">
                <h2 style="margin: 0;">SMILES 3D Visualization:</h2>
                <br>
                {{ smiles_3D_visualization|safe }}
            </div>
          </div>
          
    </div>



    


    

    <div id="PDB File Content" class="content" style="display:none;">
      <button class="home-button" onclick="location.href='{% url 'home' %}'">Home</button>
      </br>
      </br>
      <h1 class="content_pdb">PDB File Content:</h1>
      <div id="pdb_table_container">
          <!-- Use the safe filter to render the HTML table -->
          {{ pdb_read|safe }}
      </div>
    </div>



    <div id="Batch Results" class="content"  style="display:none";>
      <button class="home-button" onclick="location.href='{% url 'home' %}'">Home</button>
      <br>

    <div class="batch-container">
        
      {% if csv_data %}

        <div id="csv_table">
        <table border="1">
            <thead>
                <tr >
                    <th>Ligand (SMILES)</th>
                    <th>Protein Sequence</th>
                    <th>Predicted_Ki(nM)</th>
                </tr>
            </thead>
            <tbody>
                {% for row in result_2 %}
                <tr>
                    <td>{{ row.ligand }}</td>
                    <td>{{ row.protein }}</td>
                    <td>{{ row.prediction }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="3">No results found.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
      </div>
  
        <!-- Download CSV Button -->
        <div class="download-btn-container" >
            <button  type="button" onclick="downloadCSV()" style="padding: 8px 16px; font-size: 14px;">Download CSV</button>
        </div>

        

      

    

        <script>
          function downloadCSV() {
              var csv = [];
              var table = document.querySelector("#csv_table table");
      
              if (!table) {
                  alert("No table found to download.");
                  return;
              }
      
              var rows = table.querySelectorAll("tr");
      
              for (var i = 0; i < rows.length; i++) {
                  var row = [];
                  var cols = rows[i].querySelectorAll("th, td");
      
                  for (var j = 0; j < cols.length; j++) {
                      var data = cols[j].innerText.trim().replace(/"/g, '""'); // Trim spaces & escape quotes
                      row.push('"' + data + '"');
                  }
      
                  if (row.length > 0) {
                      csv.push(row.join(","));
                  }
              }
      
              if (csv.length === 0) {
                  alert("No data found in the table.");
                  return;
              }
      
              var csv_string = csv.join("\n");
              var filename = "downloaded_prediction.csv";
              var blob = new Blob([csv_string], { type: "text/csv;charset=utf-8;" });
      
              if (navigator.msSaveBlob) {
                  navigator.msSaveBlob(blob, filename);
              } else {
                  var link = document.createElement("a");
                  var url = URL.createObjectURL(blob);
                  link.href = url;
                  link.download = filename;
                  document.body.appendChild(link);
                  link.click();
                  document.body.removeChild(link);
              }
          }
        </script>
      
        

      {% else %}
        <div class="no-results-message" >
          <p>Upload the CSV..</p>
        </div>
      {% endif %}
    </div>
    </div>

    <div id="User Data" class="content"  style="display:none";>
      <button class="home-button" onclick="location.href='{% url 'home' %}'">Home</button>
      <br>
      <br>
      <h1>User Interaction Results</h1>
    
      {% if data_pl %}
      <div class="user-table-container">
          <table>
              <thead>
                  <tr>
                      <th>Input 1</th>
                      <th >Input 2</th>
                      <th >Ki(nM)</th>
                      <th>Timestamp</th>
                  </tr>
              </thead>
              <tbody>
                  {% for entry in data_pl %}
                      <tr>
                          <td>{{ entry.input1_user }}</td>
                          <td>{{ entry.input2_user }}</td>
                          <td>{{ entry.result_user }}</td>
                          <td>{{ entry.timestamp_user }}</td>
                      </tr>
                  {% endfor %}
              </tbody>
          </table>
      </div>
      {% else %}
          <p>No interaction results found.</p>
      {% endif %}

    </div>
    
      


  

    <div id="Analysis" class="content" style="display:none";>
      <button class="home-button" onclick="location.href='{% url 'home' %}'">Home</button>
      <br>
      <br>
  
      {% if top_n %}
        <div id="n_top_table">
          <!-- Sticky heading -->
          <h2 >
              Top 3 Minimum Predicted Ki(nM):
          </h2>
          
          <table >
              <thead>
                  <tr>
                      <th>SMILES</th>
                      <th>Protein Sequences</th>
                      <th>Predicted Ki(nM)</th>
                  </tr>
              </thead>
              <tbody>
                  {% for row in top_n %}
                      <tr>
                          <td>{{ row.ligand }}</td>
                          <td>{{ row.protein }}</td>
                          <td>{{ row.prediction }}</td>
                      </tr>
                  {% endfor %}
              </tbody>
          </table>
        </div>
    
          
  
          <!-- Download CSV Button -->
          <div >
              <button type="button" onclick="downloadNTopCSV_2()" >Download</button>
          </div>

          <script>
            function downloadNTopCSV_2() {
                let table = document.querySelector("#n_top_table table");
                if (!table) {
                    alert("No data to download.");
                    return;
                }
            
                let csvContent = "data:text/csv;charset=utf-8,";
            
                // Define the fixed column headers
                const headers = ["Ligand SMILES", "Protein Sequences", "Predicted Ki(nM)"];
                csvContent += headers.join(",") + "\n";
            
                // Loop through table rows and extract data
                let rows = table.querySelectorAll("tbody tr");
                rows.forEach(row => {
                    let rowData = [];
                    let cells = row.querySelectorAll("td");
                    cells.forEach(cell => {
                        rowData.push(cell.innerText.trim());
                    });
                    csvContent += rowData.join(",") + "\n";
                });
            
                // Create a download link
                let encodedUri = encodeURI(csvContent);
                let link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", "Top_3_Predicted_Ki.csv");
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
            </script>

      {% else %}
          <p>No data available.</p>
      {% endif %}
  </div>



    <div id="Molecular Properties" class="content" style="display:none;">
      <button class="home-button" onclick="location.href='{% url 'home' %}'">Home</button>
      </br>
      </br>
      <div class="Mol_P">
      <h1>Molecular Properties</h1>
      <p class="text">The features of the Ligand and Protein, derived from the user's input, are displayed below.</p>
      </div>
      </br>
          <div  class="descriptor-container">
            <!-- First Flex Container for Ligand Descriptors Table -->
            
            <div class="descriptor-box">
                <h2 class="descriptor-heading">Ligand Molecule: {{input1}}</h2>
                </br>
                <table class="descriptor-table">
                    <thead>
                        <tr>
                            <th>Ligand Descriptor</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for name, value in descriptors.items %}
                            <tr>
                                <td>{{ name }}</td>
                                <td>{{ value }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        
            <!-- Second Flex Container for Protein Properties Table -->
            <div class="descriptor-box">
                <h2 class="descriptor-heading">Protein Sequence: {{input2}}</h2>
                </br>
                <table border="1" class="descriptor-table">
                    <thead>
                        <tr>
                            <th>Protein Properties</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for name, value in protein_descriptors.items %}
                            <tr>
                                <td>{{ name }}</td>
                                <td>{{ value }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
          </div>
    </div>

    <br>
    <br>
    <br>
    <br>

    
    <p class="copyright">
      &copy; 2025 - <span>QClairvoyance Quantum Labs Pvt. Ltd</span> All Rights Reserved.
    </p>  
  </main>


  

  <script src="{% static 'js/app.js'%}"></script>
  <script src="{% static 'js/3D_viewer.js'%}"></script>
</body>

</html>